
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Gaugette</title>
  <meta name="author" content="Guy">

  
  <meta name="description" content="Manufacturers I am aware of three companies manufacturing compatible motors. All appear to produce a good-quality product. Switec Switec was &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://clearwater.github.com/gaugette">
  <link href="/gaugette/favicon.png" rel="icon">
  <link href="/gaugette/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/gaugette/javascripts/modernizr-2.0.js"></script>
  <script src="/gaugette/javascripts/ender.js"></script>
  <script src="/gaugette/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/gaugette/atom.xml" rel="alternate" title="Gaugette" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28552776-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/gaugette/">Gaugette</a></h1>
  
    <h2>a simple and cheap Arduino analog gauge using the Switec X25.168 stepper motor.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/gaugette/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:clearwater.github.com/gaugette" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/gaugette/about">About</a></li>
  <li><a href="/gaugette/">Blog</a></li>
  <li><a href="/gaugette/blog/archives">Archives</a></li>
  <li><a href="/gaugette/resources">Resources</a></li>
  <li><a href="https://github.com/clearwater/SwitecX25">Source Code</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/05/25/buyers-guide/">Buyers Guide</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-25T11:06:00+10:00" pubdate data-updated="true">May 25<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id='manufacturers'>Manufacturers</h2>

<p>I am aware of three companies manufacturing compatible motors. All appear to produce a good-quality product.</p>

<h3 id='switec_'>Switec <img class='right' src='/gaugette/resources/2012-05-25/x25-168.jpg' /></h3>

<p>Switec was originally the technology arm of the Swiss watch company Swatch. The stepper business was sold off to Singapore-based <a href='http://jukenswisstech.com/'>Juken Technology</a> in 2009. Switec motors are white, and have part numbers starting with &#8220;X&#8221;.</p>

<h3 id='vid_'>VID <img class='right' src='/gaugette/resources/2012-05-25/vid29-02.jpg' /></h3>

<p>Hong Kong based <a href='http://www.vid.wellgain.com/product.aspx'>VID</a> also manufacture a range of similar motors. Their motors are black, and have a black model number starting with &#8220;vid&#8221;. <br clear='right' /></p>

<h3 id='mcr_'>MCR <img class='right' src='/gaugette/resources/2012-05-25/mr1108.jpg' /></h3>

<p>Chinese company <a href='http://www.mcrmotor.com/en/'>MCR Motor</a> manufacture a range of compatible motors. Their motors are white. with part numbers starting with &#8220;MR&#8221;. <br clear='right' /></p>

<h2 id='x25_product_numbers'>X25 Product Numbers</h2>

<p>Each manufacturer produces a number of variations of the motor.</p>
<table><thead><tr><th>Switec</th><th>VID</th><th>MCR</th><th>Contacts</th><th>Mounting Pegs</th><th>Internal Stop</th><th>Shaft</th></tr></thead><tbody><tr><td style='text-align: left;'>X25.156</td><td style='text-align: left;' /><td style='text-align: left;' /><td style='text-align: left;'>rear</td><td style='text-align: left;'>no</td><td style='text-align: left;'>no</td><td style='text-align: left;'>standard</td>
</tr><tr><td style='text-align: left;'>X25.166</td><td style='text-align: left;' /><td style='text-align: left;' /><td style='text-align: left;'>rear</td><td style='text-align: left;'>no</td><td style='text-align: left;'>yes</td><td style='text-align: left;'>standard</td>
</tr><tr><td style='text-align: left;'>X25.158</td><td style='text-align: left;' /><td style='text-align: left;' /><td style='text-align: left;'>rear</td><td style='text-align: left;'>rear</td><td style='text-align: left;'>no</td><td style='text-align: left;'>standard</td>
</tr><tr><td style='text-align: left;'>X25.168</td><td style='text-align: left;'>VID29-02</td><td style='text-align: left;'>MR1108</td><td style='text-align: left;'>rear</td><td style='text-align: left;'>rear</td><td style='text-align: left;'>yes</td><td style='text-align: left;'>standard</td>
</tr><tr><td style='text-align: left;'>X25.278</td><td style='text-align: left;' /><td style='text-align: left;' /><td style='text-align: left;'>rear</td><td style='text-align: left;'>rear</td><td style='text-align: left;'>no</td><td style='text-align: left;'>long (+2mm)</td>
</tr><tr><td style='text-align: left;'>X25.288</td><td style='text-align: left;'>VID29-04</td><td style='text-align: left;' /><td style='text-align: left;'>rear</td><td style='text-align: left;'>rear</td><td style='text-align: left;'>yes</td><td style='text-align: left;'>long (+2mm)</td>
</tr><tr><td style='text-align: left;'>X25.559</td><td style='text-align: left;' /><td style='text-align: left;' /><td style='text-align: left;'>front</td><td style='text-align: left;'>front</td><td style='text-align: left;'>no</td><td style='text-align: left;'>standard</td>
</tr><tr><td style='text-align: left;'>X25.569</td><td style='text-align: left;'>VID29-05</td><td style='text-align: left;'>MR1107</td><td style='text-align: left;'>front</td><td style='text-align: left;'>front</td><td style='text-align: left;'>yes</td><td style='text-align: left;'>standard</td>
</tr><tr><td style='text-align: left;'>X25.579</td><td style='text-align: left;' /><td style='text-align: left;' /><td style='text-align: left;'>front</td><td style='text-align: left;'>front</td><td style='text-align: left;'>no</td><td style='text-align: left;'>long (+2mm)</td>
</tr><tr><td style='text-align: left;'>X25.589</td><td style='text-align: left;'>VID29-07</td><td style='text-align: left;' /><td style='text-align: left;'>front</td><td style='text-align: left;'>front</td><td style='text-align: left;'>yes</td><td style='text-align: left;'>long (+2mm)</td>
</tr><tr><td style='text-align: left;'>X25.679</td><td style='text-align: left;' /><td style='text-align: left;' /><td style='text-align: left;'>front</td><td style='text-align: left;'>front</td><td style='text-align: left;'>no</td><td style='text-align: left;'>long (+2mm)</td>
</tr><tr><td style='text-align: left;'>X25.689</td><td style='text-align: left;' /><td style='text-align: left;' /><td style='text-align: left;'>front</td><td style='text-align: left;'>front</td><td style='text-align: left;'>yes</td><td style='text-align: left;'>long (+2mm)</td>
</tr></tbody></table>
<h2 id='other_switec_series'>Other Switec Series</h2>

<h3 id='x23_series'>X23 Series</h3>

<p>The X23 motors have an a hollow metal shaft encasing a transparent light guide to make it possible to have an illuminated pointer.</p>

<h3 id='x26_series'>X26 Series</h3>

<p>The X26 motors are dual-shaft analog clock motors. The model numbers are X26.101, X26.103, X26.123, X26.504. See the the &#8220;Switec Series Buyers Guide&#8221; in the <a href='/gaugette/resources'>Resources</a> for more details.</p>

<h3 id='x27_series'>X27 Series</h3>

<p>The X27 motors are a new line replacing the X25 series. The X27 part numbers mirror the X25 series.</p>

<h3 id='x12_motor_drivers'>X12 Motor Drivers</h3>

<p>The X12 part numbers refer to a series of driver chips developed by Switec. I have not been able to locate a supplier of these chips since microcomponents.ch shut down.</p>

<h2 id='suppliers'>Suppliers</h2>

<p>I have not found any well-know online store supplying these parts. They are however cheap and plentiful on ebay. However it can be difficult to determine exactly what you are getting; these motors are generally sold as Switec X25 <em>replacements</em>, without clearly specifying the manufacturer.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/05/08/how-fast-is-it/">How Fast Is It?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-08T09:06:00+10:00" pubdate data-updated="true">May 8<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I recently <a href='/gaugette/blog/2012/04/04/pulling-out-the-stops/'>removed the internal stops</a> on a VID-29 stepper. I&#8217;ve used this free-turning motor and an optical sensor to exerimentally test some operational limits of the motor. The test rig uses a photo-interruptor to determine the needle position:</p>
<img class='right' src='/gaugette/resources/2012-05-08/accel-test.jpg' />
<h2 id='methodology'>Methodology</h2>

<p>I move the need forward under varying conditions, then move the needle back to the home position in a known-reliable manner while counting the steps. If the steps counted back do not match the number of steps programmed forward then we know we have exceeded the operational limits of the motor.</p>

<p>After some experimentation I selected a delay of 1000&#956;S per step for the counting phase as this is well within the safe limits of operation. I confirmed that in this safe range I get reliable results counting steps confirming that the sensor is accurate enough to detect a single one-third degree step.</p>

<p>Note: Be sure your needle is tight! Until I eliminated needle slippage, my results showed anomalous drifts both above and below the expected values.</p>

<h2 id='constant_speed_test'>Constant Speed Test</h2>

<p>In this test the motor is turned at constant speed to identify the maximum constant speed that the motor will respond to. The speed is set by manipulating the motor accelleration table. I also recorded the total sweep time with the <code>micros()</code> function to determine the variation between the programmed inter-step time and the actual inter-step time.</p>

<p>The following table shows the results from the constant speed test. Each test was repeated 5 times. In each case the expected result was 500.</p>
<table><thead><tr><th>Delay &#956;S</th><th>Test 1</th><th>Test 2</th><th>Test 3</th><th>Test 4</th><th>Test 5</th><th>Actual &#956;S</th><th>Steps/Sec</th><th>&#176;/S</th></tr></thead><tbody><tr><td style='text-align: left;'>500</td><td style='text-align: left;'>4</td><td style='text-align: left;'>-6</td><td style='text-align: left;'>4</td><td style='text-align: left;'>-6</td><td style='text-align: left;'>4</td><td style='text-align: left;'>509</td><td style='text-align: left;'>1964</td><td style='text-align: left;'>654</td>
</tr><tr><td style='text-align: left;'>520</td><td style='text-align: left;'>4</td><td style='text-align: left;'>-6</td><td style='text-align: left;'>4</td><td style='text-align: left;'>-6</td><td style='text-align: left;'>4</td><td style='text-align: left;'>530</td><td style='text-align: left;'>1886</td><td style='text-align: left;'>628</td>
</tr><tr><td style='text-align: left;'>540</td><td style='text-align: left;'>2</td><td style='text-align: left;'>-4</td><td style='text-align: left;'>2</td><td style='text-align: left;'>-4</td><td style='text-align: left;'>2</td><td style='text-align: left;'>549</td><td style='text-align: left;'>1821</td><td style='text-align: left;'>607</td>
</tr><tr><td style='text-align: left;'>560</td><td style='text-align: left;'>2</td><td style='text-align: left;'>-4</td><td style='text-align: left;'>2</td><td style='text-align: left;'>-5</td><td style='text-align: left;'>5</td><td style='text-align: left;'>568</td><td style='text-align: left;'>1760</td><td style='text-align: left;'>586</td>
</tr><tr><td style='text-align: left;'>580</td><td style='text-align: left;'>2</td><td style='text-align: left;'>-4</td><td style='text-align: left;'>2</td><td style='text-align: left;'>-4</td><td style='text-align: left;'>2</td><td style='text-align: left;'>589</td><td style='text-align: left;'>1697</td><td style='text-align: left;'>565</td>
</tr><tr><td style='text-align: left;'>600</td><td style='text-align: left;'>9</td><td style='text-align: left;'>2</td><td style='text-align: left;'>7</td><td style='text-align: left;'>-4</td><td style='text-align: left;'>2</td><td style='text-align: left;'>610</td><td style='text-align: left;'>1639</td><td style='text-align: left;'>546</td>
</tr><tr><td style='text-align: left;'>620</td><td style='text-align: left;'>500</td><td style='text-align: left;'>506</td><td style='text-align: left;'>500</td><td style='text-align: left;'>9</td><td style='text-align: left;'>2</td><td style='text-align: left;'>630</td><td style='text-align: left;'>1587</td><td style='text-align: left;'>529</td>
</tr><tr><td style='text-align: left;'>640</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>649</td><td style='text-align: left;'>1540</td><td style='text-align: left;'>513</td>
</tr><tr><td style='text-align: left;'>660</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>668</td><td style='text-align: left;'>1497</td><td style='text-align: left;'>499</td>
</tr><tr><td style='text-align: left;'>680</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>691</td><td style='text-align: left;'>1447</td><td style='text-align: left;'>482</td>
</tr><tr><td style='text-align: left;'>700</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>711</td><td style='text-align: left;'>1406</td><td style='text-align: left;'>468</td>
</tr><tr><td style='text-align: left;'>720</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>729</td><td style='text-align: left;'>1371</td><td style='text-align: left;'>457</td>
</tr><tr><td style='text-align: left;'>740</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>749</td><td style='text-align: left;'>1335</td><td style='text-align: left;'>445</td>
</tr><tr><td style='text-align: left;'>760</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>771</td><td style='text-align: left;'>1297</td><td style='text-align: left;'>432</td>
</tr><tr><td style='text-align: left;'>780</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>791</td><td style='text-align: left;'>1264</td><td style='text-align: left;'>421</td>
</tr><tr><td style='text-align: left;'>800</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>500</td><td style='text-align: left;'>810</td><td style='text-align: left;'>1234</td><td style='text-align: left;'>411</td>
</tr></tbody></table>
<h2 id='results'>Results</h2>

<p>The results show that with a programmed step period 600&#956;S or less the motor could not advance with each step - and in fact often moved backwards. At 620&#956;S the results were unreliable, and at 640&#956;S and above the motor behaved reliably.</p>

<p>The actual inter-step delay was 8 to 11 &#956;S more than the programmed delay.</p>

<h2 id='observations'>Observations</h2>

<p>I compared my results with the VID29 data sheet which states rather confusingly that &#8220;The angular speed can reach more than 500Hz&#8221; (presumably they mean &#176;/S, not Hz?), and elsewhere that the maximum driving frequency is 600Hz (I can&#8217;t make any sense of that). The ~10&#956;S difference between programmed delay and measured delay gives a useful measure of the error of the timing logic in the SwitecX25 library.</p>

<p>In setting up this test I discovered a bug in the SwitecX25 library: the library does not enforce a timing delay between the last signal change before stopping, and the first signal change after starting. This only exhibits if the motor is stopped and immediately restarted (within ~600&#956;S). Because the two signals come too close together, the step may be missed. This leaves the motor out of phase with the libraries state map, and it appears the motor then misses 5 more steps before it gets back into phase, so this error shows as a 6-step error.</p>

<h2 id='test_code'>Test Code</h2>

<p>Here&#8217;s the full <a href='https://gist.github.com/2590599/73ff197ea22c312335c6d02cd9c1333eb238db50'>source code</a> for this test.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/04/04/making-wiring-harnesses/">Making Wiring Harnesses</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-04T13:05:00+10:00" pubdate data-updated="true">Apr 4<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A quick note about wiring harnesses for these motors. I&#8217;ve found it really handy to make harnesses from 4-wire CD audio cables. My harnesses use push-on connectors at the motor end so I never <a href='http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1260978962'>accidentally cook the motor</a> by soldering to the motor pins.</p>

<p><img alt='image' src='/gaugette/resources/2012-04-04/imgp9232.jpg' /></p>

<p>The cables I&#8217;m talking about have 4-pin JST connectors on each end, and are used to connect the analog audio signal from a PC&#8217;s internal CD player to the motherboard or sound card. I have accumulated a bunch of these over the years, so I&#8217;m glad to have a use for them.</p>

<p>I also use <a href='https://www.adafruit.com/products/392'>0.1&#8221; breakaway headers</a> and heatshrink tubing, both from AdaFruit.</p>

<p><img alt='image' src='/gaugette/resources/2012-04-04/imgp9227.jpg' /></p>

<ul>
<li>Chop the audio cable in half (each half makes one wiring harness),</li>

<li>Strip and tin the wires on the cut end,</li>

<li>Cut off a 4-pin section of breakaway header,</li>

<li>Solder the wires to the header <em>with the two black wires in the center positions</em>,</li>

<li>Protect the connections with heat-shrink tubing.</li>
</ul>

<p><img alt='image' src='/gaugette/resources/2012-04-04/imgp9228.jpg' /></p>

<ul>
<li>Pull up the plastic tabs on the JST connector and slide the crimped terminator out of the block,</li>

<li>Use pliers to close the crimp connectors a little, but don&#8217;t crush them entirely. The pins on the Switec motors are really small, so you need to squeeze it down a little to create a tight fit.</li>
</ul>

<p><img alt='image' src='/gaugette/resources/2012-04-04/imgp9229.jpg' /></p>

<p>You&#8217;ll notice that these harnesses have two black wires, which would normally be a bit annoying. However it turns out that the wires to pins 2 and 3 on the Switec motors are interchangable so you don&#8217;t need to distinguish between them.</p>

<p>Wire your motor up like this:</p>
<table><thead><tr><th>Motor Pin</th><th>Wire Color</th><th>Arduino Pin</th></tr></thead><tbody><tr><td style='text-align: left;'>1</td><td style='text-align: left;'>white</td><td style='text-align: left;'>4</td>
</tr><tr><td style='text-align: left;'>2</td><td style='text-align: left;'>black</td><td style='text-align: left;'>5</td>
</tr><tr><td style='text-align: left;'>3</td><td style='text-align: left;'>black</td><td style='text-align: left;'>6</td>
</tr><tr><td style='text-align: left;'>4</td><td style='text-align: left;'>red</td><td style='text-align: left;'>7</td>
</tr></tbody></table>
<p>Be careful not to bend the pins on the motors when you slide the crimp connectors on. Also note that the pins on the motor are flat, not round, so the orientation of the crimp connector matters; if it is too tight or too lose, try rotating the connector 90 degrees.</p>

<p>Finally, if you plug the header into an Arduino so that white is at pin 4, and red is pin 7, you can define your motor in code like this:</p>
<figure class='code'><div class='highlight'><table><tr><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SwitecX25 motor1(MOTOR_STEPS, 4,5,6,7);</span></code></pre></td></tr></table></div></figure></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/04/04/pulling-out-the-stops/">Pulling Out All the Stops</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-04T09:58:00+10:00" pubdate data-updated="true">Apr 4<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Or more accurately, filing off the stops.</p>

<p>Recently <a href='http://clearwater.github.com/gaugette/about/index.html#comment-459699391'>Tim Hirzel asked</a> if I knew of a source of motors without stops, or if the X25.168&#8217;s could be modified to remove the stops and open up the full 360 degrees of rotation.</p>

<p>Good question! The <a href='/gaugette/resources'>X25 Series Buyers Guide</a> lists 6 models of motors without stops, but a quick search turned up no suppliers selling these in small volumes.</p>

<p>Okay, time to figure out if the stops can be removed. Note that I&#8217;m working on a VID-29 clone, not a genuine Switec X25.168 here. There are 4 tiny screws that open the case revealing this:</p>

<p><img alt='image' src='/gaugette/resources/2012-04-04/imgp9223.jpg' /></p>

<p>The drive-shaft and attached gear sit loose and can be lifted out. Flipping the gear over reveals the mechanism for the stop; a raised trapezoidal bump on the gear face that stops against a matching protrusion at the bottom of the case.</p>

<p><img alt='image' src='/gaugette/resources/2012-04-04/imgp9225.jpg' /></p>

<p>I cut off the stop with a Stanley knife, and filed it flat with a small file.</p>

<p><img alt='image' src='/gaugette/resources/2012-04-04/imgp9226.jpg' /></p>

<p>Reassembly was easy, and bugger me, it works.</p>

<p>In the video you can see the needle hesitates on each rotation. This is because of the acceleration/deceleration logic in the SwitecX25 library; I&#8217;m accelerating the motor from stop, spinning 360 degrees, decelerating to a stop again, then repeating, using code like this:</p>
<figure class='code'><div class='highlight'><table><tr><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>      for (int i=0;i&lt;nLoops;i++) {
</span><span class='line'>        motor-&gt;currentStep = 0;    
</span><span class='line'>        motor-&gt;setPosition(360*3);
</span><span class='line'>        while (!motor-&gt;stopped) motor-&gt;update();
</span><span class='line'>      }</span></code></pre></td></tr></table></div></figure>
<p>To keep the speed constant I need to prevent it coming to a stop. I can do that by resetting the origin and destination before it reaches its goal step, like this:</p>
<figure class='code'><div class='highlight'><table><tr><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>      for (int i=0;i&lt;nLoops;i++) {
</span><span class='line'>        motor-&gt;currentStep = 0;         // reset origin on each rotation 
</span><span class='line'>        motor-&gt;setPosition(320*3*2);    // set target to way past end of rotation
</span><span class='line'>        while (motor-&gt;currentStep&lt;360*3) motor-&gt;update();  // turn until rotation is complete
</span><span class='line'>      }</span></code></pre></td></tr></table></div></figure>
<p>Or to run the motor in reverse:</p>
<figure class='code'><div class='highlight'><table><tr><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>      for (int i=0;i&lt;nLoops;i++) {
</span><span class='line'>        motor-&gt;currentStep = 360*3*2;
</span><span class='line'>        motor-&gt;setPosition(0);
</span><span class='line'>        while (motor-&gt;currentStep&gt;360*3) motor-&gt;update();
</span><span class='line'>      }</span></code></pre></td></tr></table></div></figure>
<p>I think the SwitecX25 library will need some extensions to support stop-less motors&#8230; need to think about that a bit.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/03/22/a-better-backlight/">A Better Backlight</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-22T11:18:00+10:00" pubdate data-updated="true">Mar 22<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For the second gauge in this build, I tried to get better placement of the current-limiting resistor. By placing it tight in the corner, it wont cast a shadow.</p>

<p>These photos show the LEDs at 100% brightness, but they are on PWM pins so I can control the intensity from the Arduino code.</p>
<img class='center' src='/gaugette/resources/backlight2.png' />
<p>It is subtle, but in the next photo you can see the difference between the first and second gauge. The right-most gauge has a dark spot between 30 and 40. It&#8217;s fine, and the light spread isn&#8217;t that even anyway, so I&#8217;m going to call it &#8216;character&#8217;.</p>
<img class='center' src='/gaugette/resources/backlight-pair.png' />
<p>The mounting panel is made from salvaged hardwood fence pickets. It&#8217;s red stringybark, very hard and with nice colour and grain definition.</p>
<img class='center' src='/gaugette/resources/build1-mount.png' />
<p>I&#8217;ve wired the 3-position switch to control &#8220;off&#8221;, &#8220;on&#8221; and &#8220;on with backlight&#8221;.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/02/16/using-the-switecx25-library/">Using the SwitecX25 Library</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-16T18:04:00+10:00" pubdate data-updated="true">Feb 16<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id='getting_started_with_the_switecx25_library'>Getting Started with the SwitecX25 Library</h2>

<p>For Arduino IDE version 1.0 and later you can store user-contributed libraries in a subdirectory of your sketch directory named &#8216;libraries&#8217;. In fact you really should install them there to ensure that they persist when you upgrade the IDE.</p>

<p>So figure out where your project directory is (under OSX this is available in the <code>Arduino -&gt; Preferences</code> menu), create a subdirectory called <code>libraries</code> with the project directory. The name is important, so use exactly that. Then inside that libraries directory checkout the SwitecX25 library. You should end up with this structure: <figure class='code'><div class='highlight'><table><tr><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>libraries
</span><span class='line'>  |
</span><span class='line'>  +-- SwitecX25
</span><span class='line'>     |
</span><span class='line'>     +-- SwitecX25.cpp
</span><span class='line'>         SwitecX25.h</span></code></pre></td></tr></table></div></figure></p>

<p>There is also an examples directory under that, but those two files are the critical parts of the library.</p>

<p>Restart the IDE and you should see the library in your <code>Sketch -&gt; Import Library</code> menu. It appears in a separate section at the bottom marked <code>contributed</code>. Now start a new sketch. Here&#8217;s a minimum Hello World sketch for the Switec X25 that runs the motor against the zero stop then moves the motor to the center of its range.</p>
<figure class='code'><div class='highlight'><table><tr><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;SwitecX25.h&gt;
</span><span class='line'>
</span><span class='line'>// standard X25.168 range 315 degrees at 1/3 degree steps
</span><span class='line'>#define STEPS (315*3)
</span><span class='line'>
</span><span class='line'>// For motors connected to pins 3,4,5,6
</span><span class='line'>SwitecX25 motor1(STEPS,3,4,5,6);
</span><span class='line'>
</span><span class='line'>void setup(void)
</span><span class='line'>{
</span><span class='line'>  // run the motor against the stops
</span><span class='line'>  motor1.zero();
</span><span class='line'>  // start moving towards the center of the range
</span><span class='line'>  motor1.setPosition(STEPS/2);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>void loop(void)
</span><span class='line'>{
</span><span class='line'>  // the motor only moves when you call update
</span><span class='line'>  motor1.update();
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>
<p>I&#8217;ve added this little sketch to the library as an example, so it will appear as <code>File -&gt; Examples -&gt; SwitecX25 -&gt; center</code>.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/02/11/backlighting/">LED Gauge Backlighting</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-11T17:14:00+10:00" pubdate data-updated="true">Feb 11<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><img class='right' src='/gaugette/resources/thermo_backlit.png' title='LED Backlighting' />
<p>Today I added an LED backlight to my square gauge. I really like how light leaks from the grills at the top and bottom of gauge.</p>

<p>I decided not to use RGB LEDs in this build due to size and pin-count constraints. The white LED was originally part of a solar-powered LED light string.</p>

<p>These are side-emitting LEDs by virtue of a conical indent in the tip of the lens that refracts much of the light sideways. I tried grinding back the lens and using blobs of hot-glue to make the lighting more diffuse, but in the end I wasn&#8217;t convinced it was an improvement, and so the simpler design won out.</p>
<img class='left' src='/gaugette/resources/thermo_led.png' title='with face removed' />
<p>I soldered the 330&#8486; current-limiting resistor to the LED. I trimmed the leads on the LED and resistor really short to get it all to fit. I would have liked the resistor tight against the wall to prevent a dark spot, but it didn&#8217;t work out that way.</p>

<p>The holes for the connection wires had to be drilled right in the extreme inner corner to avoid the stepper motor on the back. The cathode wire goes to a PWM pin on the Arduino, and the anode to ground. I recently added LED control options to the Gaugette software to control the brightness.</p>
<img class='right' src='http://www.battlecruiserzone.com/Boom1.jpg' />
<p>ZOMG, now this gauge <a href='http://totallylookslike.icanhascheezburger.com/'>totally looks like</a> the helmets worn by the Viper pilots in the original 80&#8217;s Battlestar Galactica series!</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/02/06/just-a-pretty-face/">Just a Pretty Face</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-06T17:33:00+10:00" pubdate data-updated="true">Feb 6<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><img class='right' src='/gaugette/resources/100k_square_dial.png' title='Dial Face Artwork' />
<p>I made dial faces for a couple of the square gauges built in <a href='/gaugette/blog/2012/01/28/build-number-one/'>Build Number One</a>. Nearly ready to install these guys.</p>

<p>Laying out the line-work on the square faces presents an interesting challenge. I decided to generate the <a href='https://github.com/clearwater/gaugette/blob/master/tools/square_dial/dial.png'>bare line-work</a> programmatically with a <a href='https://github.com/clearwater/gaugette/blob/master/tools/square_dial/dial.rb'>ruby script</a>, and add the labels later with a graphics tool.</p>

<p>My first attempt at the script used the GD2 library, but <a href='http://gd2.rubyforge.org/rdoc/'>GD2</a> doesn&#8217;t seem to support anti-aliasing or line-caps and the resulting line-work was just too damned ugly. I switched to <a href='http://rubyforge.org/projects/cairo/'>Cairo</a> which makes pretty, pretty lines. A revelation at this point was that I could use Cairo&#8217;s clipping operator to trim the graticule lines and remove the messy trig I was coding to figure out line intersections and stroke lengths. Finally I imported the generated image into OpenOffice to add the text labels.</p>

<p>So what to print on? On a recent trip to Cairns I looked in Officeworks for ideas. I didn&#8217;t find any card stock I liked, but I did find some 120 gsm paper (Quill brand &#8220;Metallique&#8221; in Mother of Pearl) with a cool metallic / opalesque finish. 120 gsm is heavier than standard typing paper, and maybe barely stiff enough to support itself in the gauge. Over time it might curl or slump in the varying humidity here in the tropics. There is just enough drive shaft length to place the paper over the original dial plate so that the needle just clears the face, but if the paper will support itself I could backlight it with an LED which might look nice in the dark.</p>
<img class='left' src='/gaugette/resources/fiskars_hole_punch.png' title='Fiskars Hole Punch' />
<p>One thing that had me stuffed is how to punch a neat hole in the paper for the drive shaft. A standard hole-punch is too big and can&#8217;t reach far enough from the edge of the paper. Drilling would leave messy edges. Scouring the aisles at Officeworks I found a <a href='http://www.fiskarscraft.eu/Products/Craft/Punches/Eyelet-Setter/Eyelet-Setter-Pack'>set of three eyelet setters</a> from Fiskars in the scrap-booking section. The hole punches use a crazy spring-driven hammer mechanism, so you can position them anywhere on the page, pull back the hammer, and smack, you have a hole. I was reckon I want a 3mm hole, and the middle size is 3.2mm (1/8&#8221;). The downside is the set of 3 cost about $25. Anyway they work a treat and now I have some crafty hole punches.</p>
<img class='right' src='/gaugette/resources/finished_square_face.png' title='Custom Dial Face' />
<p>I tried printing the dials with an ink-jet. That seemed okay until I mounted it in the gauge and I found that at certain angles the metallic finish on the paper made the line-work look really washed out. Redoing the printing with a laser printer gave much better results.</p>

<p>After installing the new face I calibrated it carefully and found a discrepancy between the printed face and needle position that I can&#8217;t explain. If I line up zero precisely, then at full-scale (230 degrees sweep) I find the needle is about 2 degrees short of the 100% mark on the dial. I&#8217;m not sure what the source of error is - presumably just measurement and positioning errors - but it is easily solved by changing the stepper motor sweep from 690 steps to 696 steps to full-scale deflection.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/02/04/source-code-cleanup/">Separation Anxiety</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-04T11:38:00+10:00" pubdate data-updated="true">Feb 4<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><img class='right' src='/gaugette/resources/dial_parts.png' title='Separation Anxiety' />
<p>I&#8217;ve separated the Switec X25 motor driver code into a separate library repository on GitHub. This will make it easier to use the driver library in other applications.</p>

<h2 id='switecx25_library'><a href='https://github.com/clearwater/SwitecX25'>SwitecX25 Library</a></h2>

<p>This contains only the Switec X25 driver.</p>

<h2 id='gaugette'><a href='https://github.com/clearwater/gaugette'>Gaugette</a></h2>

<p>This is an arduino application that controls analog gauges by interpreting commands received over the serial interface. To compile Gaugette you will now need to add the SwitecX25 library to your Arduino libraries folder.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/01/28/build-number-one/">Gauge Build Number One</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-28T15:56:00+10:00" pubdate data-updated="true">Jan 28<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><img class='left' src='/gaugette/resources/thermo_original.jpg' title='$5 Hygrometer' />
<p>This weekend I opened up one of the cheap-but-funky thermometers/hygrometers from <a href='http://www.letsmaketime.com.au'>Lets Make Time</a> and replaced the thermometer mechanism with the Arduino-controlled Switec X25.168 stepper.</p>

<p>The thermometer and hygrometer are installed in identical one-part plastic housings with no screws or seams, so it wasn&#8217;t clear how to crack them open. <img class='right' src='/gaugette/resources/thermo_back.jpg' title='back removed' /> I used a Dremel to cut away the back panel giving access to the thermometer mechanism, but to my surprise the dial face was still firmly locked in place. After a bit of poking around I discovered that I could push the whole assembly out forward - in fact the plastic lens is only held in by friction, and the dial and mechanism are held in by the lens. No cutting was required. #LFMF</p>
<img class='left' src='/gaugette/resources/thermo_disassembly.jpg' title='thermometer disassembly' />
<p>This turned out to be important because after careful measurement I realized that the motor would have to be mounted snugly against the the back of the housing to leave the drive shaft protruding enough to attach a needle. The plastic panel I cut away would have been ideal to screw the motor to. Starting again with an undamaged housing, I gently pried out the plastic lens, removed the face and mechanism. This time I only cut away enough plastic on the back to allow the drive shaft to pass through.</p>
<img class='right' src='/gaugette/resources/thermo_mount.jpg' title='mechanism removal' />
<p>The needle and the bi-metal thermometer coil came off the face easily enough, but the mounting for the coil is a crafty two-piece deal that mounts through the centre of the dial. It appeared to be assembled a bit like a rivet, and a couple of solid blows from the back with a punch released it cleanly from the dial face.</p>
<img class='left' src='/gaugette/resources/thermo_glued.jpg' title='hot glue to the rescue' />
<p>I originally intended to use screws to secure the stepper to the back of the housing, but there isn&#8217;t much tolerance for positional error, which made me nervous. Instead I used the conical rivet-thingy to precisely align the motor drive shaft in hole in the dial and held it all in place while I hot-glued it to the back of the case. Alignment was spot-on the the motor seems to be solidly secured. So far so good.</p>

<p>Next I wired up the Arduino and zeroed the motor against the low stop and put the needle on. There were some unexpected complications at this point. The motor has a sweep of 315 degrees, but this dial only allows about 230 degrees of needle movement. I modified the library to support a soft range limit to avoid exceeding 230 degrees, while still running through a full 315 degrees during reset.</p>

<p>While trying to calibrate the dial I found the needle slipping at times, especially under vibration caused by the power-on reset or slow stepping. With the needle slipping calibration was impossible. I tried applying the smallest drop of hot glue I could manage to the back of the needle. That really didn&#8217;t work - the tiny irregular mass between the needle and the dial face would sometimes bind against the dial face, causing more problems.</p>

<p>I believe the needle hole is dished a little, so I removed the needle, cleaned the glue away, and smacked it with a hammer to flatten out the dish and close up the hole. That worked a little too well and I had to ream the hole out a bit with a thumb tack. Now the needle is nice and snug, no slippage.</p>
<iframe allowFullScreen='allowFullScreen' frameborder='0' height='390' mozallowfullscreen='mozallowfullscreen' src='http://www.youtube.com/embed/UJKaaRR9W6g' webkitAllowFullScreen='webkitAllowFullScreen' width='640'> </iframe>
<p>So here&#8217;s how it looks assembled. Calibration is slightly out, but I&#8217;m going to make a new dial face anyway, so no need to sweat about that.</p></div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/gaugette/blog/page/2/">&larr; Older</a>
    
    <a href="/gaugette/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/gaugette/blog/2012/05/25/buyers-guide/">Buyers Guide</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/05/08/how-fast-is-it/">How Fast Is It?</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/04/04/making-wiring-harnesses/">Making Wiring Harnesses</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/04/04/pulling-out-the-stops/">Pulling Out All The Stops</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/03/22/a-better-backlight/">A Better Backlight</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/02/16/using-the-switecx25-library/">Using the SwitecX25 Library</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/02/11/backlighting/">LED Gauge Backlighting</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/02/06/just-a-pretty-face/">Just a Pretty Face</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/02/04/source-code-cleanup/">Separation Anxiety</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/28/build-number-one/">Gauge Build Number One</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/26/well-aint-that-shiny/">Well Ain&#8217;t That Shiny!</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/26/simplified-acceleration-model/">A Simplified Acceleration Model</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/24/attack-of-the-switec-clones/">Attack of the Switec Clones?</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/23/controlling-two-motors/">Two Motors, One Arduino</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/19/x12-quad-driver-chip/">X12 Quad Driver Chip</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/15/needle-acceleration/">Motor Acceleration and Deceleration</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/09/initial-results/">Initial Results</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/05/what-is-gaugette/">What is Gaugette?</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  
  <a href="https://github.com/guyc">@guyc</a> on Github
  
  
  </script>
  <script src="/gaugette/javascripts/github.js" type="text/javascript"> </script>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Guy -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'gaugetteblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
