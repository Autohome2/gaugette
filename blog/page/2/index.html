
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Gaugette</title>
  <meta name="author" content="Guy">

  
  <meta name="description" content="The logic in the advance() function of the Switec X25 library steps the motor forward or backward one step, then computes the delay in microseconds &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://clearwater.github.com/gaugette/blog/page/2">
  <link href="/gaugette/favicon.png" rel="icon">
  <link href="/gaugette/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/gaugette/javascripts/modernizr-2.0.js"></script>
  <script src="/gaugette/javascripts/ender.js"></script>
  <script src="/gaugette/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/gaugette/atom.xml" rel="alternate" title="Gaugette" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28552776-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/gaugette/">Gaugette</a></h1>
  
    <h2>a simple and cheap Arduino analog gauge using the Switec X25.168 stepper motor.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/gaugette/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:clearwater.github.com/gaugette" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/gaugette/about">About</a></li>
  <li><a href="/gaugette/">Blog</a></li>
  <li><a href="/gaugette/blog/archives">Archives</a></li>
  <li><a href="/gaugette/resources">Resources</a></li>
  <li><a href="https://github.com/clearwater/SwitecX25">Source Code</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/01/26/simplified-acceleration-model/">A Simplified Acceleration Model</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-26T09:42:00+10:00" pubdate data-updated="true">Jan 26<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The logic in the <code>advance()</code> function of the <a href='https://github.com/clearwater/SwitecX25'>Switec X25 library</a> steps the motor forward or backward one step, then computes the delay in microseconds until the next step is due. This logic determines the acceleration curve and maximum speed of the needle. My first cut at this code used floating point arithmetic to model this as time/accel/velocity problem. The motion was nice and smooth, but it was overkill, and consumes too many precious Arduino compute cycles. When driving multiple motors, this will create an artificial ceiling on the maximum motor speed.</p>

<p>I&#8217;ve rewritten that logic to use a simple lookup table instead. This is a fairly obvious approach, but it was reassuring to see similar approaches recommended in both the <a href='/gaugette/resources/vid/2009111395111_Acceleration_&amp;_reset_calculation_example.pdf'>VID 29 documentation</a> and the <a href='/gaugette/resources/mcr/2010410104915847.pdf'>MCR MR1107 data sheet</a>.</p>

<p>The acceleration curve is defined as pairs of vel,delay values:</p>
<pre><code>unsigned short accelTable[][2] = {
  {   10, 5000},
  {   30, 1500},
  {  100, 1000},
  {  150,  800},
  {  300,  600}
};
</code></pre>
<p>We maintain a variable <code>vel</code> (which isn&#8217;t actually velocity, but is a surrogate for velocity) that increments each step under acceleration, and decrements each step under deceleration. When stationary, <code>vel</code> is zero. After 1 step of acceleration it is 1. For simplicity I&#8217;ve made the acceleration and deceleration curves identical so they can share the same lookup table.</p>

<p>To determine the inter-step delay at any given value of <code>vel</code>, we find the first table entry such that <code>accelTable[i][0] &lt; vel</code>. In practice this means that the motor will step at 5000 &#181;S intervals for 9 steps, then 1500 &#181;S steps for the next 20 steps, 1000 &#181;S for the next 70 steps, and so on. The peak speed with a delay of 600 &#181;S equates to 1666 Hz step rate or about 500 degrees per second.</p>

<p>The motion control logic first determines if the motor is subject to acceleration, at full speed, or deceleration and adjusts <code>vel</code> accordingly. Using steps as the unit for <code>vel</code> makes it very easy to determine when to declerate: when <code>vel</code> is greater than or equal to the number of steps to reach our destination, we need to start decelerating.</p>
<img class='right' src='/gaugette/resources/VID29_accel.png' title='From the VID29 Tech Note' />
<p>The new logic also ensures that if the motor is moving at speed in one direction and is directed to a new position in the opposite direction it will decelerate to a stop before accelerating in the opposite direction.</p>

<p>The constants that make up the acceleration table are constrained by the the inertia of the needle attached to the motor. The <a href='/gaugette/resources/vid/2009111395111_Acceleration_&amp;_reset_calculation_example.pdf'>VID 29 documentation</a> gives some recommendations for calculating these values, but I actually didn&#8217;t use that. I experimented until I found values that were within operational limits and look nice to me.</p>

<p>I tested this code driving 3 motors simultaneously with an Arduino Uno. All good. New code is in the <a href='https://github.com/clearwater/SwitecX25'>library on Github</a>.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/01/24/attack-of-the-switec-clones/">Attack of the Switec Clones?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-24T09:29:00+10:00" pubdate data-updated="true">Jan 24<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><img class='right' src='/gaugette/resources/X25_clone.png' title='Switec Clones' />
<p>When my eBay Switec X25.168 motors arrived, they didn&#8217;t look at all like the white motors with the &#8220;Switec&#8221; branding that I&#8217;ve been seeing online. I finally got around to tracking down what exactly they are. They have two identification numbers printed black on black: <code>vid29-02p</code> and <code>d11455db</code>.</p>
<img class='right' src='/gaugette/resources/VID29_diagram.png' title='Motor Diagram' />
<p>It turns out that the first number is the model, and these are in reality VID29 series stepper motors from <a href='http://www.vid.wellgain.com/product.aspx'>Hong Kong VID</a>. Interestingly their <a href='/gaugette/resources/vid/20091026113525_VID29_manual_EN-080606.pdf'>data sheet</a> includes details of recommended acceleration characteristics to bring the motors to full speed without visible and audible jitter. Cool cool cool.</p>

<p>Armed with that information I turned up what appears to be a third manufacturer, <a href='http://www.mcrmotor.com/en/'>MCR Motor</a> who call this motor the MR1108. The MCR <a href='/gaugette/resources/mcr/2010410104720473.pdf'>data sheet</a> lists the Switec and VID motors as alternatives.</p>

<p>The eBay seller had these marked unambiguously as X25.168 motors in their auction, but didn&#8217;t specifically say they were from Switec. I wonder if any of the eBay offers are actual Switec motors?</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/01/23/controlling-two-motors/">Two Motors, One Arduino</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-23T14:39:00+10:00" pubdate data-updated="true">Jan 23<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Last night I built a pair of improved wiring harnesses so I could connect two motors to the Arduino. Once concern I have is that the control logic that manages the acceleration and deceleration could be so slow that it will interfere with the motor drive signaling when trying to control more than one motor. I have in mind to replace the floating point logic with a lookup table, but for now I like being able to easily fiddle with the motion parameters.</p>

<p>It turns out that two motors work pretty well with only minor tweaks to the existing code.</p>
<iframe allowfullscreen='allowfullscreen' frameborder='0' height='315' src='http://www.youtube.com/embed/Z-f4m18n48I' width='560' /></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/01/19/x12-quad-driver-chip/">X12 Quad Driver Chip</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-19T17:10:00+10:00" pubdate data-updated="true">Jan 19<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><img class='right' src='/gaugette/resources/X12_Quad_Driver.png' title='Switec X12.017 Quad Driver' />
<p>The <a href='/gaugette/resources/switec/X25_xxx_01_SP_E-1.pdf'>X25 data sheet</a> describes the X12 family of driver chips which allow up to 4 Switec motors to be controlled over a 3-wire serial interface. I like the look of these for keeping the I/O count down, and offloading a bunch of processing from the Arduino.</p>

<p>However I have been unable to find a supplier for X12 quad driver chips. It seems that they were available until recently from Swatch subsidiary Microcomponents Ltd. at microcomponents.ch, but after Swatch <a href='http://www.swatchgroup.com/en/services/archive/2009/swatch_group_sale_of_microcomponents_automotive_business_activities_to_juken_technology'>sold the stepping motor business</a> to Singapore-based <a href='http://www.jukenswisstech.com'>Juken Techonology</a> in 2009, that website disappeared.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/01/15/needle-acceleration/">Motor Acceleration and Deceleration</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-15T19:38:00+10:00" pubdate data-updated="true">Jan 15<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><iframe allowfullscreen='allowfullscreen' frameborder='0' height='315' src='http://www.youtube.com/embed/uNLySm71OBc' width='560' />
<p>My first cut at the <a href='https://github.com/clearwater/gaugette'>Switec X25 library</a> stepped the needle at a constant speed. You can see the constant speed motion in the <a href='http://www.youtube.com/watch?v=vwAxRk_5oXA'>original video</a>.</p>

<p>I&#8217;ve updated the library to support acceleration and deceleration, partly because it seems more aesthetically pleasing, and partly because I have a notion that I should be able to reach faster peak speeds by ramping the speed up. Motion is now specified by 4 parameters: minimum speed, maximum speed, acceleration, deceleration.</p>

<p>For now I&#8217;ve used floating point calculations to compute each step period standard Newtonian velocity/distance/time calculations. This works okay, but is unnecessarily compute-intensive.</p>

<p>The Switec X25 library supports multiple motors and no doubt this computation will become a factor when I try to drive more than one motor, so I&#8217;ll have to address that at some point.</p>

<p>One interesting aspect of the control logic is that the calculations are done at the start of each step, in distance-domain rather than in time domain like most simulations. This means the calculations must be done more frequently at higher needle speeds. This is going to set an upper bound on maximum step rate.</p>

<p>When it does become an issue, I think I could replace the entire floating point calculation with a small table of pre-computed (step-count, step-period) pairs with little perceptible difference.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/01/09/initial-results/">Initial Results</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-09T14:16:00+10:00" pubdate data-updated="true">Jan 9<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id='wiring_it_up'>Wiring It Up</h2>

<p>Given the comments by <a href='http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1260978962'>Toby Catlin</a> about cooking the motors while soldering, I opted to make up a harness with a connector rather than soldering directly to the motor. The pins on each winding exactly match the spacing of the first and fourth pins of a standard 0.1&#8221; connector. JST RE connectors are the right pitch, but the pins on the motor are too short and too narrow to engage with the connectors. For my first harness I cut up a floppy disk cable connector into two 4-hole sections and soldered wire to the first and fourth pins. It worked fine but it is pretty bulky, and the metal contacts in the connector did not solder very easily. For now I just pushed the tinned ends of the wires directly into the Arduino connectors.</p>

<p>I wrote some code for the Arduino to step the motor using the IO pattern established in <a href='http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1260978962'>this post</a> and a quick ruby script to query my pfSense firewall to get some live data to test with.</p>

<p>Add some duct tape for a gauge, and behold the simplest analog bandwidth meter ever:</p>
<iframe allowfullscreen='allowfullscreen' frameborder='0' height='315' src='http://www.youtube.com/embed/vwAxRk_5oXA' width='560' /></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/gaugette/blog/2012/01/05/what-is-gaugette/">What Is Gaugette?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-05T13:11:00+10:00" pubdate data-updated="true">Jan 5<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Gaugette is a project detailing the construction of custom analog gauges using an Arduino microcontroller and Switec X25.168 stepper motors. Each motor requires 4 digital I/O pins, and a single Arduino can drive three motors. The limit is purely due to Aruidno limit of 14 digital I/O lines.</p>
<iframe allowfullscreen='allowfullscreen' frameborder='0' height='315' src='http://www.youtube.com/embed/Z-f4m18n48I' width='560' />
<p>Source code for the project is available on <a href='https://github.com/clearwater/gaugette'>GitHub</a>.</p>

<h2 id='motivation'>Motivation</h2>

<p>After playing with the <a href='http://www.adafruit.com/products/171'>motor shield party pack</a> from Adafruit, I started thinking it would be fun to have a couple of analog gauges mounted on the wall somewhere to show system health indication; maybe network bandwidth or web traffic? <img class='right' src='http://blog.skytee.com/wp-content/uploads/2010/11/B-300x277.jpg' title='TorrentMeter by Skytee' /> Of course I&#8217;ve seen the very beautiful <a href='http://blog.skytee.com/2010/11/torrentmeter-a-steampunk-bandwidth-meter/'>TorrentMeter by Skytee</a> which is so pretty it makes me weep, but beautiful brass antique voltmeters are in short supply around here.</p>

<p>The servos and steppers in the Adafruit pack aren&#8217;t ideal for driving gauges. The little stepper they include runs really hot. The servo seemed like possibility and it is driven by PWM, so I wouldn&#8217;t even need the motor shield. But it is quite bulky and noisy, so I started looking for something better.</p>

<h2 id='the_switec_x25_stepper_motor'>The Switec X25 Stepper Motor</h2>
<img class='right' src='/gaugette/resources/Switec_X25_168.jpg' title='Switec X26.168 Stepper Motor' />
<p>I noticed a lot of sellers on eBay selling tiny Switec X25 motors as replacements for GM auto instrument clusters. They were developed by the technology arm of Swatch, so I figured they should be low power and pretty quiet. Certainly they are cheap; under $5 each!</p>

<p>The X25 motors have 6 steps per revolution, and a 180:1 gearbox, giving a resolution of 1/3 degree. The <a href='/gaugette/resources/switec/X25_xxx_01_SP_E-1.pdf'>data sheet</a> indicates they draw no more than 20mA per winding, which is low enough to source directly from the 5V Arduino data pins, raising the possibility of driving these without an intermediate controller chip. Yes, I understand the risks associated with wiring inductive loads directly to the microcontroller. Arduinos are cheap, why not try it?</p>

<p>On the net I found an excellent <a href='http://www.mycockpit.org/forums/content.php/355-An-Easy-Approach-to-an-Analog-Gauge'>overview of the Switec X25 by Mike Powell</a>. Mike expresses concerns about driving inductive loads directly from the microcontroller and uses an external L293D driver. There is an intriguing <a href='http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1260978962'>thread by Toby Catlin</a> which approaches the issue of driving these without a controller, but the thread ends abruptly at the point where he sees the first signs of success. What happens next? Blue smoke?</p>

<p>At the price I figured it was worth a shot driving these directly, so I ordered 6 from <a href='http://stores.ebay.com.au/partsangel'>one of many</a> eBay stores selling them. Apparently a complete GM instrument cluster has 6 motors, so 6 is a popular quantity. In all it cost about $25 including postage from the US to Australia. At the time of writing they carry both the X25.168 with rear contacts, and the X25.589 with front contacts and a longer indicator shaft. Both have internal stops. See the <a href='/gaugette/resources/switec/ISM_Buyers_Guide.pdf'>buyers guide</a> for details on the different models.</p></div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/gaugette/blog/archives">Blog Archives</a>
    
    <a class="next" href="/gaugette/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/gaugette/blog/2012/05/08/how-fast-is-it/">How Fast Is It?</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/04/04/making-wiring-harnesses/">Making Wiring Harnesses</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/04/04/pulling-out-the-stops/">Pulling Out All The Stops</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/03/22/a-better-backlight/">A Better Backlight</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/02/16/using-the-switecx25-library/">Using the SwitecX25 Library</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/02/11/backlighting/">LED Gauge Backlighting</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/02/06/just-a-pretty-face/">Just a Pretty Face</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/02/04/source-code-cleanup/">Separation Anxiety</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/28/build-number-one/">Gauge Build Number One</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/26/well-aint-that-shiny/">Well Ain&#8217;t That Shiny!</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Guy -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'gaugetteblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
