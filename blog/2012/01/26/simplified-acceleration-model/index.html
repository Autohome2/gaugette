
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>A Simplified Acceleration Model - Gaugette</title>
  <meta name="author" content="Guy">

  
  <meta name="description" content="The logic in the advance() function of the
Switec X25 library
steps the motor forward or backward one step, then computes the delay in
microseconds &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://clearwater.github.com/gaugette/blog/2012/01/26/simplified-acceleration-model">
  <link href="/gaugette/favicon.png" rel="icon">
  <link href="/gaugette/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/gaugette/javascripts/modernizr-2.0.js"></script>
  <script src="/gaugette/javascripts/ender.js"></script>
  <script src="/gaugette/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/gaugette/atom.xml" rel="alternate" title="Gaugette" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28552776-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/gaugette/">Gaugette</a></h1>
  
    <h2>a simple and cheap Arduino analog gauge using the Switec X25.168 stepper motor.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/gaugette/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:clearwater.github.com/gaugette" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/gaugette/about">About</a></li>
  <li><a href="/gaugette/">Blog</a></li>
  <li><a href="/gaugette/blog/archives">Archives</a></li>
  <li><a href="/gaugette/resources">Resources</a></li>
  <li><a href="https://github.com/clearwater/gaugette">Source Code</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">A Simplified Acceleration Model</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-26T09:42:00+10:00" pubdate data-updated="true">Jan 26<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>The logic in the <code>advance()</code> function of the
<a href="https://github.com/clearwater/SwitecX25">Switec X25 library</a>
steps the motor forward or backward one step, then computes the delay in
microseconds until the next step is due.  This logic determines the acceleration curve and
maximum speed of the needle.  My first cut at this
code used floating point arithmetic to model this as time/accel/velocity problem.  The
motion was nice and smooth, but it was overkill, and consumes too many precious Arduino
compute cycles.  When driving multiple motors, this will create an artificial ceiling on the
maximum motor speed.</p>

<p>I&#8217;ve rewritten that logic to use a simple lookup table instead.
This is a fairly obvious approach, but it was
reassuring to see similar approaches recommended in both the
<a href="/gaugette/resources/vid/2009111395111_Acceleration_&amp;_reset_calculation_example.pdf">VID 29 documentation</a>
and the <a href="/gaugette/resources/mcr/2010410104915847.pdf">MCR MR1107 data sheet</a>.</p>

<p>The acceleration curve is defined as pairs of vel,delay values:</p>

<pre><code>unsigned short accelTable[][2] = {
  {   10, 5000},
  {   30, 1500},
  {  100, 1000},
  {  150,  800},
  {  300,  600}
};
</code></pre>


<p>We maintain a variable <code>vel</code> (which isn&#8217;t actually velocity,
but is a surrogate for velocity) that increments
each step under acceleration, and decrements each step under deceleration.
When stationary, <code>vel</code> is zero.  After 1 step of acceleration it is 1.
For simplicity I&#8217;ve made the acceleration and deceleration curves identical
so they can share the same lookup table.</p>

<p>To determine the inter-step delay at any given value of <code>vel</code>, we find
the first table entry such that <code>accelTable[i][0] &lt; vel</code>.  In practice this means that the
motor will step at 5000 &micro;S intervals for 9 steps, then 1500 &micro;S
steps for the next 20 steps, 1000 &micro;S for the next 70 steps, and so on.
The peak speed with a delay of 600 &micro;S equates to 1666 Hz step rate
or about 500 degrees per second.</p>

<p>The motion control logic first determines if the motor is subject to acceleration,
at full speed, or deceleration and adjusts <code>vel</code> accordingly.  Using
steps as the unit for <code>vel</code> makes it very
easy to determine when to declerate: when <code>vel</code> is greater than or equal to the number of steps
to reach our destination, we need to start decelerating.</p>

<p><img class="right" src="/gaugette/resources/VID29_accel.png" title="From the VID29 Tech Note" >
The new logic also ensures that if the motor is moving at
speed in one direction and is directed to a new position in the opposite direction it will
decelerate to a stop before accelerating in the opposite direction.</p>

<p>The constants that make up the acceleration table are constrained by the
the inertia of the needle attached to the motor.  The
<a href="/gaugette/resources/vid/2009111395111_Acceleration_&amp;_reset_calculation_example.pdf">VID 29 documentation</a>
gives some recommendations for calculating these values, but I actually
didn&#8217;t use that.  I experimented until I
found values that were within operational limits and look nice to me.</p>

<p>I tested this code driving 3 motors simultaneously with an Arduino Uno.
All good.  New code is in the <a href="https://github.com/clearwater/SwitecX25">library on Github</a>.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Guy</span></span>

      








  


<time datetime="2012-01-26T09:42:00+10:00" pubdate data-updated="true">Jan 26<span>th</span>, 2012</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://clearwater.github.com/gaugette/blog/2012/01/26/simplified-acceleration-model/" data-via="" data-counturl="http://clearwater.github.com/gaugette/blog/2012/01/26/simplified-acceleration-model/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/gaugette/blog/2012/01/24/attack-of-the-switec-clones/" title="Previous Post: Attack of the Switec Clones?">&laquo; Attack of the Switec Clones?</a>
      
      
        <a class="basic-alignment right" href="/gaugette/blog/2012/01/26/well-aint-that-shiny/" title="next Post: Well Ain't That Shiny!">Well Ain't That Shiny! &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/gaugette/blog/2012/02/16/using-the-switecx25-library/">Using the SwitecX25 Library</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/02/11/backlighting/">LED Gauge Backlighting</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/02/06/just-a-pretty-face/">Just a Pretty Face</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/02/04/source-code-cleanup/">Separation Anxiety</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/28/build-number-one/">Gauge Build Number One</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/26/well-aint-that-shiny/">Well Ain't That Shiny!</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/26/simplified-acceleration-model/">A Simplified Acceleration Model</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/24/attack-of-the-switec-clones/">Attack of the Switec Clones?</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/23/controlling-two-motors/">Two Motors, One Arduino</a>
      </li>
    
      <li class="post">
        <a href="/gaugette/blog/2012/01/19/x12-quad-driver-chip/">X12 Quad Driver Chip</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Guy -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'gaugetteblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://clearwater.github.com/gaugette/blog/2012/01/26/simplified-acceleration-model/';
        var disqus_url = 'http://clearwater.github.com/gaugette/blog/2012/01/26/simplified-acceleration-model/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
